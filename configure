#!/usr/bin/env bash
set -e
set -u
set -o pipefail


hexoshi_configure_main() {
    local python_version=3.6.8
    local venv=./var/venv

    if [[ "Python ${python_version}" != $(python3 --version) ]]; then
        pyenv --version
        if [[ ! -d "${HOME}/.pyenv/versions/${python_version}" ]]; then
            pyenv install ${python_version}
        fi
        pyenv local ${python_version}
    fi

    python3 -m venv ${venv}

    ${venv}/bin/pip3 install --upgrade pip \
        && ${venv}/bin/pip3 install -r requirements.txt

    cd data/locale \
        && ./build.py \
        && cd ../.. \
            || echo "locale failed"

    echo -e "\nActivate your local development environment:"
    echo -e "\n    source ${venv}/bin/activate"
}


hexoshi_configure_main $@
